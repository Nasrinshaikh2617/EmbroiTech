<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EmbroiTech - Premium Embroidery Marketplace</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #1a202c;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100%;
    }
    
    /* Authentication Screens */
    .auth-container {
      min-height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 20px;
    }
    
    .auth-box {
      background: white;
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 480px;
      width: 100%;
      overflow: hidden;
    }
    
    .auth-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px 32px;
      text-align: center;
    }
    
    .auth-logo {
      width: 80px;
      height: 80px;
      background: white;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      margin: 0 auto 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }
    
    .auth-header h1 {
      font-size: 28px;
      margin-bottom: 8px;
    }
    
    .auth-header p {
      font-size: 15px;
      opacity: 0.95;
    }
    
    .auth-body {
      padding: 40px 32px;
    }
    
    .form-group {
      margin-bottom: 24px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2d3748;
      font-size: 14px;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 15px;
      font-family: inherit;
      transition: all 0.3s;
      background: #f7fafc;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .btn {
      padding: 14px 24px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      white-space: nowrap;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      width: 100%;
      padding: 16px;
      font-size: 16px;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }
    
    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .btn-secondary {
      background: #48bb78;
      color: white;
    }
    
    .btn-secondary:hover {
      background: #38a169;
      transform: translateY(-2px);
    }
    
    .btn-outline {
      background: white;
      color: #667eea;
      border: 2px solid #667eea;
    }
    
    .btn-outline:hover {
      background: #667eea;
      color: white;
    }
    
    .btn-danger {
      background: #f56565;
      color: white;
    }
    
    .btn-danger:hover {
      background: #e53e3e;
    }
    
    .btn-small {
      padding: 10px 16px;
      font-size: 13px;
    }
    
    .btn-icon {
      position: relative;
    }
    
    .auth-footer {
      text-align: center;
      padding: 24px 32px;
      background: #f7fafc;
      border-top: 1px solid #e2e8f0;
    }
    
    .auth-footer p {
      color: #718096;
      font-size: 14px;
    }
    
    .auth-footer a {
      color: #667eea;
      text-decoration: none;
      font-weight: 600;
      cursor: pointer;
    }
    
    .auth-footer a:hover {
      text-decoration: underline;
    }
    
    .password-strength {
      height: 4px;
      background: #e2e8f0;
      border-radius: 2px;
      margin-top: 8px;
      overflow: hidden;
    }
    
    .password-strength-bar {
      height: 100%;
      width: 0%;
      transition: all 0.3s;
      border-radius: 2px;
    }
    
    .password-strength-bar.weak {
      width: 33%;
      background: #f56565;
    }
    
    .password-strength-bar.medium {
      width: 66%;
      background: #f6ad55;
    }
    
    .password-strength-bar.strong {
      width: 100%;
      background: #48bb78;
    }
    
    /* Header Styles */
    header {
      background: white;
      padding: 20px 32px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      margin-bottom: 24px;
      position: sticky;
      top: 20px;
      z-index: 100;
    }
    
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .logo-section {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    
    .brand-info h1 {
      font-size: 24px;
      color: #667eea;
      margin-bottom: 2px;
    }
    
    .brand-info p {
      font-size: 13px;
      color: #718096;
    }
    
    .search-bar {
      display: flex;
      align-items: center;
      background: #f7fafc;
      border-radius: 12px;
      padding: 12px 20px;
      gap: 12px;
      min-width: 400px;
      border: 2px solid #e2e8f0;
      transition: all 0.3s;
    }
    
    .search-bar:focus-within {
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .search-bar input {
      border: none;
      background: transparent;
      outline: none;
      flex: 1;
      font-size: 15px;
    }
    
    .search-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      margin-top: 8px;
      max-height: 300px;
      overflow-y: auto;
      display: none;
      z-index: 1000;
    }
    
    .search-suggestions.active {
      display: block;
    }
    
    .search-suggestion-item {
      padding: 12px 20px;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      border-bottom: 1px solid #f7fafc;
    }
    
    .search-suggestion-item:hover {
      background: #f7fafc;
    }
    
    .search-suggestion-item:last-child {
      border-bottom: none;
    }
    
    .suggestion-icon {
      font-size: 20px;
    }
    
    .suggestion-text {
      flex: 1;
    }
    
    .suggestion-text strong {
      display: block;
      color: #2d3748;
      margin-bottom: 2px;
    }
    
    .suggestion-text span {
      font-size: 12px;
      color: #718096;
    }
    
    .header-actions {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .user-menu {
      position: relative;
    }
    
    .user-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      border: 3px solid white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s;
    }
    
    .user-avatar:hover {
      transform: scale(1.1);
    }
    
    .user-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      background: white;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
      margin-top: 8px;
      min-width: 220px;
      display: none;
      z-index: 1000;
    }
    
    .user-dropdown.active {
      display: block;
    }
    
    .user-dropdown-header {
      padding: 16px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .user-dropdown-header strong {
      display: block;
      color: #2d3748;
      margin-bottom: 4px;
    }
    
    .user-dropdown-header span {
      font-size: 13px;
      color: #718096;
    }
    
    .user-dropdown-item {
      padding: 12px 16px;
      cursor: pointer;
      transition: background 0.2s;
      display: flex;
      align-items: center;
      gap: 12px;
      color: #2d3748;
      font-size: 14px;
    }
    
    .user-dropdown-item:hover {
      background: #f7fafc;
    }
    
    .user-dropdown-item:last-child {
      border-top: 1px solid #e2e8f0;
      color: #f56565;
    }
    
    .badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #f56565;
      color: white;
      border-radius: 50%;
      width: 22px;
      height: 22px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: bold;
      border: 2px solid white;
    }
    
    .nav-tabs {
      display: flex;
      gap: 8px;
      border-bottom: 2px solid #e2e8f0;
      padding-bottom: 8px;
      overflow-x: auto;
    }
    
    .nav-tab {
      padding: 10px 20px;
      background: transparent;
      border: none;
      font-size: 14px;
      font-weight: 600;
      color: #718096;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s;
      white-space: nowrap;
    }
    
    .nav-tab:hover {
      background: #f7fafc;
      color: #667eea;
    }
    
    .nav-tab.active {
      background: #667eea;
      color: white;
    }
    
    /* Main Layout */
    .main-layout {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    
    .sidebar {
      background: white;
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      height: fit-content;
      position: sticky;
      top: 140px;
    }
    
    .sidebar h3 {
      font-size: 18px;
      margin-bottom: 20px;
      color: #2d3748;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .filter-section {
      margin-bottom: 28px;
    }
    
    .filter-section label {
      display: block;
      margin-bottom: 12px;
      font-size: 14px;
      font-weight: 600;
      color: #4a5568;
    }
    
    .filter-option {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .filter-option:hover {
      background: #f7fafc;
    }
    
    .filter-option input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #667eea;
    }
    
    .filter-option label {
      margin: 0;
      cursor: pointer;
      font-weight: 400;
      font-size: 14px;
      flex: 1;
    }
    
    .filter-count {
      font-size: 12px;
      color: #a0aec0;
      background: #f7fafc;
      padding: 2px 8px;
      border-radius: 10px;
    }
    
    .price-range {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .price-input {
      width: 100%;
      padding: 10px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
    }
    
    /* Content Area */
    .content-area {
      background: white;
      padding: 32px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      min-height: 600px;
    }
    
    .view-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .view-header h2 {
      font-size: 28px;
      color: #2d3748;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .results-count {
      font-size: 15px;
      color: #718096;
      font-weight: 400;
    }
    
    .view-controls {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .sort-select {
      padding: 10px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      background: white;
    }
    
    .view-toggle {
      display: flex;
      gap: 4px;
      background: #f7fafc;
      padding: 4px;
      border-radius: 8px;
    }
    
    .view-toggle button {
      padding: 8px 12px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 6px;
      font-size: 18px;
      transition: all 0.2s;
    }
    
    .view-toggle button.active {
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Product Grid */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
    }
    
    .products-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .product-card {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 16px;
      overflow: hidden;
      transition: all 0.3s;
      cursor: pointer;
      position: relative;
    }
    
    .product-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.15);
      border-color: #667eea;
    }
    
    .product-badge {
      position: absolute;
      top: 12px;
      right: 12px;
      background: #48bb78;
      color: white;
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      z-index: 10;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .product-badge.out-of-stock {
      background: #f56565;
    }
    
    .product-badge.new {
      background: #9f7aea;
    }
    
    .wishlist-btn {
      position: absolute;
      top: 12px;
      left: 12px;
      background: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
      z-index: 10;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .wishlist-btn:hover {
      transform: scale(1.15);
    }
    
    .wishlist-btn.active {
      color: #f56565;
      background: #fff5f5;
    }
    
    .product-image {
      width: 100%;
      height: 240px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 72px;
      position: relative;
      overflow: hidden;
    }
    
    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }
    
    .product-card:hover .product-image img {
      transform: scale(1.05);
    }
    
    .product-info {
      padding: 20px;
    }
    
    .product-category {
      font-size: 11px;
      color: #667eea;
      background: #edf2f7;
      padding: 5px 12px;
      border-radius: 12px;
      display: inline-block;
      margin-bottom: 10px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .product-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 10px;
    }
    
    .product-tag {
      font-size: 10px;
      color: #718096;
      background: #f7fafc;
      padding: 4px 10px;
      border-radius: 10px;
      font-weight: 600;
    }
    
    .product-name {
      font-size: 17px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 10px;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .product-rating {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
      font-size: 14px;
    }
    
    .stars {
      color: #f6ad55;
      letter-spacing: 2px;
    }
    
    .rating-value {
      font-weight: 600;
      color: #2d3748;
    }
    
    .review-count {
      color: #a0aec0;
      font-size: 13px;
    }
    
    .product-price {
      font-size: 24px;
      font-weight: 700;
      color: #48bb78;
      margin-bottom: 16px;
    }
    
    .product-actions {
      display: flex;
      gap: 10px;
    }
    
    .product-actions .btn {
      flex: 1;
    }
    
    /* List View */
    .product-card-list {
      display: flex;
      gap: 20px;
      border: 2px solid #e2e8f0;
      border-radius: 16px;
      padding: 20px;
      transition: all 0.3s;
      background: white;
    }
    
    .product-card-list:hover {
      border-color: #667eea;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    
    .product-card-list .product-image {
      width: 200px;
      height: 200px;
      flex-shrink: 0;
      border-radius: 12px;
    }
    
    .product-card-list .product-info {
      flex: 1;
      padding: 0;
    }
    
    /* Admin Panel */
    .admin-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 28px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
    }
    
    .stat-card h3 {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .stat-card .stat-value {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 4px;
    }
    
    .stat-card .stat-label {
      font-size: 13px;
      opacity: 0.8;
    }
    
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow-y: auto;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 32px;
      max-width: 600px;
      width: 100%;
      max-height: 90%;
      overflow-y: auto;
      position: relative;
      margin: auto;
    }
    
    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: #f56565;
      color: white;
      border: none;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }
    
    .modal-close:hover {
      transform: rotate(90deg);
      background: #e53e3e;
    }
    
    .image-upload-area {
      border: 3px dashed #cbd5e0;
      border-radius: 16px;
      padding: 48px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 20px;
      background: #f7fafc;
    }
    
    .image-upload-area:hover {
      border-color: #667eea;
      background: #edf2f7;
    }
    
    .image-upload-area.has-image {
      padding: 0;
      border: none;
      background: transparent;
    }
    
    .upload-icon {
      font-size: 56px;
      margin-bottom: 16px;
    }
    
    .image-preview {
      width: 100%;
      max-height: 350px;
      object-fit: cover;
      border-radius: 16px;
      display: none;
    }
    
    .image-preview.active {
      display: block;
    }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 100px 20px;
      color: #718096;
    }
    
    .empty-state-icon {
      font-size: 96px;
      margin-bottom: 24px;
      opacity: 0.5;
    }
    
    .empty-state h3 {
      font-size: 24px;
      margin-bottom: 12px;
      color: #2d3748;
    }
    
    .empty-state p {
      font-size: 16px;
      margin-bottom: 24px;
    }
    
    /* Notification */
    .notification {
      position: fixed;
      top: 24px;
      right: 24px;
      background: #48bb78;
      color: white;
      padding: 18px 28px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.3);
      z-index: 2000;
      display: none;
      animation: slideIn 0.3s ease;
      max-width: 400px;
      font-weight: 500;
    }
    
    .notification.active {
      display: block;
    }
    
    .notification.error {
      background: #f56565;
    }
    
    .notification.info {
      background: #4299e1;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .loading-spinner {
      display: none;
      text-align: center;
      padding: 24px;
      color: #667eea;
      font-size: 16px;
      font-weight: 600;
    }
    
    .loading-spinner.active {
      display: block;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .loading-overlay.active {
      display: flex;
    }
    
    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid #e2e8f0;
      border-top-color: #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    /* Responsive */
    @media (max-width: 1200px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        position: static;
      }
    }
    
    @media (max-width: 768px) {
      .header-top {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search-bar {
        width: 100%;
        min-width: auto;
      }
      
      .header-actions {
        width: 100%;
        justify-content: space-between;
      }
      
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      }
      
      .view-header {
        flex-direction: column;
        align-items: stretch;
      }
      
      .view-controls {
        justify-content: space-between;
      }
    }
    
    @media (max-width: 480px) {
      .products-grid {
        grid-template-columns: 1fr;
      }
      
      .admin-stats {
        grid-template-columns: 1fr;
      }
      
      .auth-box {
        margin: 0;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div id="loadingOverlay" class="loading-overlay">
   <div>
    <div class="spinner"></div>
    <p style="margin-top: 20px; color: #667eea; font-weight: 600;">Loading...</p>
   </div>
  </div><!-- Authentication Screen -->
  <div id="authScreen" class="auth-container"><!-- Login Form -->
   <div id="loginForm" class="auth-box">
    <div class="auth-header">
     <div class="auth-logo">
      üßµ
     </div>
     <h1 id="authStoreName">EmbroiTech</h1>
     <p id="authWelcomeMessage">Discover Beautiful Embroidery Designs</p>
    </div>
    <div class="auth-body">
     <form onsubmit="handleLogin(event)">
      <div class="form-group"><label for="loginEmail">Email Address</label> <input type="email" id="loginEmail" required placeholder="your@email.com" autocomplete="email">
      </div>
      <div class="form-group"><label for="loginPassword">Password</label> <input type="password" id="loginPassword" required placeholder="Enter your password" autocomplete="current-password">
      </div><button type="submit" class="btn btn-primary" id="loginBtn"> üîê Sign In </button>
     </form>
    </div>
    <div class="auth-footer">
     <p>Don't have an account? <a onclick="showSignup()">Create Account</a></p>
    </div>
   </div><!-- Signup Form -->
   <div id="signupForm" class="auth-box" style="display: none;">
    <div class="auth-header">
     <div class="auth-logo">
      üßµ
     </div>
     <h1>Create Account</h1>
     <p>Join EmbroiTech Today</p>
    </div>
    <div class="auth-body">
     <form onsubmit="handleSignup(event)">
      <div class="form-group"><label for="signupFullName">Full Name</label> <input type="text" id="signupFullName" required placeholder="John Doe" autocomplete="name">
      </div>
      <div class="form-group"><label for="signupEmail">Email Address</label> <input type="email" id="signupEmail" required placeholder="your@email.com" autocomplete="email">
      </div>
      <div class="form-group"><label for="signupPhone">Phone Number</label> <input type="tel" id="signupPhone" required placeholder="+91 98765 43210" autocomplete="tel">
      </div>
      <div class="form-group"><label for="signupPassword">Password</label> <input type="password" id="signupPassword" required placeholder="Create a strong password" autocomplete="new-password" oninput="checkPasswordStrength()">
       <div class="password-strength">
        <div class="password-strength-bar" id="passwordStrengthBar"></div>
       </div>
      </div>
      <div class="form-group"><label for="signupAddress">Address (Optional)</label> <textarea id="signupAddress" placeholder="Your delivery address" autocomplete="street-address"></textarea>
      </div><button type="submit" class="btn btn-primary" id="signupBtn"> ‚ú® Create Account </button>
     </form>
    </div>
    <div class="auth-footer">
     <p>Already have an account? <a onclick="showLogin()">Sign In</a></p>
    </div>
   </div>
  </div><!-- Main Application -->
  <div id="mainApp" class="container" style="display: none;"><!-- Header -->
   <header>
    <div class="header-top">
     <div class="logo-section">
      <div class="logo">
       üßµ
      </div>
      <div class="brand-info">
       <h1 id="storeName">EmbroiTech</h1>
       <p id="storeTagline">Premium Embroidery Designs</p>
      </div>
     </div>
     <div style="position: relative; flex: 1; max-width: 600px;">
      <div class="search-bar"><span style="font-size: 20px;">üîç</span> <input type="text" id="mainSearch" placeholder="Search: kurti, choli, ghagra, mirror design..." oninput="handleSearch()" onfocus="showSearchSuggestions()" onblur="hideSearchSuggestions()"> <button onclick="startVoiceSearch()" class="btn btn-outline btn-small" style="padding: 8px 12px; margin-left: 8px; white-space: nowrap;" title="Voice Search"> üé§ Voice </button> <button onclick="openDrawingModal()" class="btn btn-outline btn-small" style="padding: 8px 12px; margin-left: 4px; white-space: nowrap;" title="Draw Design"> ‚úèÔ∏è Draw </button> <button onclick="openImageSearchModal()" class="btn btn-outline btn-small" style="padding: 8px 12px; margin-left: 4px; white-space: nowrap;" title="Search by Image"> üì∑ Image </button>
      </div>
      <div class="search-suggestions" id="searchSuggestions"></div>
     </div>
     <div class="header-actions"><button class="btn btn-outline btn-icon" onclick="showView('wishlist')"> <span>‚ù§Ô∏è</span> <span class="badge" id="wishlistCount">0</span> </button> <button class="btn btn-primary btn-icon" onclick="showView('cart')"> <span>üõí</span> <span class="badge" id="cartCount">0</span> </button>
      <div class="user-menu">
       <div class="user-avatar" onclick="toggleUserMenu()" id="userAvatar">
        U
       </div>
       <div class="user-dropdown" id="userDropdown">
        <div class="user-dropdown-header"><strong id="userDisplayName">User</strong> <span id="userDisplayEmail">user@email.com</span>
        </div>
        <div class="user-dropdown-item" onclick="showView('profile')">
         üë§ My Profile
        </div>
        <div class="user-dropdown-item" onclick="showView('orders')">
         üì¶ My Orders
        </div>
        <div class="user-dropdown-item" onclick="showView('admin')" id="adminMenuItem" style="display: none;">
         ‚öôÔ∏è Admin Dashboard
        </div>
        <div class="user-dropdown-item" onclick="handleLogout()">
         üö™ Logout
        </div>
       </div>
      </div>
     </div>
    </div>
    <nav class="nav-tabs"><button class="nav-tab active" onclick="showView('browse')">üè† Home</button> <button class="nav-tab" onclick="showView('categories')">üìÇ Categories</button> <button class="nav-tab" onclick="showView('trending')">üî• Trending</button> <button class="nav-tab" onclick="showView('new')">‚ú® New Arrivals</button> <button class="nav-tab" onclick="showView('about')">‚ÑπÔ∏è About</button>
    </nav>
   </header><!-- Main Layout -->
   <div class="main-layout"><!-- Sidebar Filters -->
    <aside class="sidebar" id="filterSidebar">
     <h3>üéØ Filters</h3>
     <div class="filter-section"><label>Category</label>
      <div class="filter-option"><input type="checkbox" id="filterMirror" value="Mirror Work" onchange="applyFilters()"> <label for="filterMirror">Mirror Work</label> <span class="filter-count" id="countMirror">0</span>
      </div>
      <div class="filter-option"><input type="checkbox" id="filterHand" value="Hand Embroidery" onchange="applyFilters()"> <label for="filterHand">Hand Embroidery</label> <span class="filter-count" id="countHand">0</span>
      </div>
      <div class="filter-option"><input type="checkbox" id="filterZari" value="Zari Work" onchange="applyFilters()"> <label for="filterZari">Zari Work</label> <span class="filter-count" id="countZari">0</span>
      </div>
      <div class="filter-option"><input type="checkbox" id="filterThread" value="Thread Work" onchange="applyFilters()"> <label for="filterThread">Thread Work</label> <span class="filter-count" id="countThread">0</span>
      </div>
      <div class="filter-option"><input type="checkbox" id="filterSequin" value="Sequin Work" onchange="applyFilters()"> <label for="filterSequin">Sequin Work</label> <span class="filter-count" id="countSequin">0</span>
      </div>
     </div>
     <div class="filter-section"><label>Price Range (‚Çπ)</label>
      <div class="price-range"><input type="number" class="price-input" id="minPrice" placeholder="Min" oninput="applyFilters()"> <span>-</span> <input type="number" class="price-input" id="maxPrice" placeholder="Max" oninput="applyFilters()">
      </div>
     </div>
     <div class="filter-section"><label>Rating</label>
      <div class="filter-option"><input type="checkbox" id="rating5" value="5" onchange="applyFilters()"> <label for="rating5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5 Stars</label>
      </div>
      <div class="filter-option"><input type="checkbox" id="rating4" value="4" onchange="applyFilters()"> <label for="rating4">‚≠ê‚≠ê‚≠ê‚≠ê 4+ Stars</label>
      </div>
      <div class="filter-option"><input type="checkbox" id="rating3" value="3" onchange="applyFilters()"> <label for="rating3">‚≠ê‚≠ê‚≠ê 3+ Stars</label>
      </div>
     </div>
     <div class="filter-section"><label>Availability</label>
      <div class="filter-option"><input type="checkbox" id="inStockOnly" onchange="applyFilters()"> <label for="inStockOnly">In Stock Only</label>
      </div>
     </div><button class="btn btn-outline" style="width: 100%; margin-top: 16px;" onclick="clearFilters()"> Clear All Filters </button>
    </aside><!-- Main Content Area -->
    <main class="content-area"><!-- Browse View -->
     <div id="browseView" class="view-content">
      <div class="view-header">
       <div>
        <h2>‚ú® All Designs <span class="results-count" id="resultsCount">(0 items)</span></h2>
       </div>
       <div class="view-controls"><select class="sort-select" id="sortSelect" onchange="applyFilters()"> <option value="newest">Newest First</option> <option value="price-low">Price: Low to High</option> <option value="price-high">Price: High to Low</option> <option value="rating">Highest Rated</option> <option value="popular">Most Popular</option> </select>
        <div class="view-toggle"><button class="active" onclick="setViewMode('grid')" id="gridViewBtn">‚äû</button> <button onclick="setViewMode('list')" id="listViewBtn">‚ò∞</button>
        </div>
       </div>
      </div>
      <div class="products-grid" id="productsGrid">
       <div class="empty-state">
        <div class="empty-state-icon">
         üé®
        </div>
        <h3>No designs available yet</h3>
        <p>Be the first to upload beautiful embroidery designs!</p>
       </div>
      </div>
     </div><!-- Categories View -->
     <div id="categoriesView" class="view-content" style="display: none;">
      <div class="view-header">
       <h2>üìÇ Browse by Category</h2>
      </div>
      <div class="products-grid" id="categoriesGrid"></div>
     </div><!-- Trending View -->
     <div id="trendingView" class="view-content" style="display: none;">
      <div class="view-header">
       <h2>üî• Trending Designs</h2>
      </div>
      <div class="products-grid" id="trendingGrid"></div>
     </div><!-- New Arrivals View -->
     <div id="newView" class="view-content" style="display: none;">
      <div class="view-header">
       <h2>‚ú® New Arrivals</h2>
      </div>
      <div class="products-grid" id="newGrid"></div>
     </div><!-- Wishlist View -->
     <div id="wishlistView" class="view-content" style="display: none;">
      <div class="view-header">
       <h2>‚ù§Ô∏è My Wishlist</h2>
      </div>
      <div class="products-grid" id="wishlistGrid"></div>
     </div><!-- Cart View -->
     <div id="cartView" class="view-content" style="display: none;">
      <div class="view-header">
       <h2>üõí Shopping Cart</h2>
      </div>
      <div id="cartContent"></div>
     </div><!-- Profile View -->
     <div id="profileView" class="view-content" style="display: none;">
      <div class="view-header">
       <h2>üë§ My Profile</h2>
      </div>
      <div style="max-width: 600px;">
       <form onsubmit="updateProfile(event)">
        <div class="form-group"><label for="profileName">Full Name</label> <input type="text" id="profileName" required>
        </div>
        <div class="form-group"><label for="profileEmail">Email</label> <input type="email" id="profileEmail" disabled>
        </div>
        <div class="form-group"><label for="profilePhone">Phone</label> <input type="tel" id="profilePhone" required>
        </div>
        <div class="form-group"><label for="profileAddress">Address</label> <textarea id="profileAddress"></textarea>
        </div><button type="submit" class="btn btn-primary">Update Profile</button>
       </form>
      </div>
     </div><!-- Orders View -->
     <div id="ordersView" class="view-content" style="display: none;">
      <div class="view-header">
       <h2>üì¶ My Orders</h2>
      </div>
      <div class="empty-state">
       <div class="empty-state-icon">
        üì¶
       </div>
       <h3>No orders yet</h3>
       <p>Start shopping to see your orders here</p>
      </div>
     </div><!-- About View -->
     <div id="aboutView" class="view-content" style="display: none;">
      <div class="view-header">
       <h2>‚ÑπÔ∏è About EmbroiTech</h2>
      </div>
      <div style="max-width: 800px; margin: 0 auto; line-height: 1.8;">
       <p style="font-size: 16px; color: #4a5568; margin-bottom: 24px;">Welcome to EmbroiTech - your premier destination for exquisite embroidery designs. We connect talented artisans with customers who appreciate fine craftsmanship.</p>
       <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 32px; border-radius: 16px; margin-bottom: 32px;">
        <h3 style="margin-bottom: 20px; color: white; font-size: 24px;">üìß Contact Us</h3>
        <div style="display: grid; gap: 16px;">
         <div style="display: flex; align-items: center; gap: 12px;"><span style="font-size: 24px;">üìß</span>
          <div><strong style="display: block; margin-bottom: 4px;">Email</strong> <a href="mailto:contact@embroitech.com" style="color: white; text-decoration: none; opacity: 0.95;" id="contactEmail">contact@embroitech.com</a>
          </div>
         </div>
         <div style="display: flex; align-items: center; gap: 12px;"><span style="font-size: 24px;">üì±</span>
          <div><strong style="display: block; margin-bottom: 4px;">Phone</strong> <a href="tel:+919876543210" style="color: white; text-decoration: none; opacity: 0.95;" id="contactPhone">+91 98765 43210</a>
          </div>
         </div>
         <div style="display: flex; align-items: center; gap: 12px;"><span style="font-size: 24px;">üïê</span>
          <div><strong style="display: block; margin-bottom: 4px;">Business Hours</strong> <span style="opacity: 0.95;">Mon-Sat: 9:00 AM - 8:00 PM IST</span>
          </div>
         </div>
         <div style="display: flex; align-items: center; gap: 12px;"><span style="font-size: 24px;">üìç</span>
          <div><strong style="display: block; margin-bottom: 4px;">Location</strong> <span style="opacity: 0.95;">Mumbai, Maharashtra, India</span>
          </div>
         </div>
        </div>
       </div>
       <div style="background: #fff5f5; border-left: 4px solid #f56565; padding: 20px; border-radius: 8px; margin-top: 32px;">
        <p style="color: #c53030; font-weight: 600; margin-bottom: 8px;">‚ö†Ô∏è Important Note:</p>
        <p style="color: #742a2a; font-size: 14px; line-height: 1.6;">This is a functional prototype. For production deployment with real payment processing, SMS notifications, and AI-powered search, you'll need to integrate backend services (Node.js/Python), payment gateways (Razorpay/Stripe), SMS APIs (Twilio/MSG91), and image storage (AWS S3/Cloudinary).</p>
       </div>
      </div>
     </div><!-- Admin View -->
     <div id="adminView" class="view-content" style="display: none;">
      <div class="view-header">
       <h2>‚öôÔ∏è Admin Dashboard</h2><button class="btn btn-secondary" onclick="openUploadModal()"> ‚ûï Upload Design </button>
      </div>
      <div class="admin-stats">
       <div class="stat-card">
        <h3>Total Designs</h3>
        <div class="stat-value" id="totalDesigns">
         0
        </div>
        <div class="stat-label">
         Uploaded designs
        </div>
       </div>
       <div class="stat-card" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">
        <h3>In Stock</h3>
        <div class="stat-value" id="inStockCount">
         0
        </div>
        <div class="stat-label">
         Available items
        </div>
       </div>
       <div class="stat-card" style="background: linear-gradient(135deg, #f6ad55 0%, #ed8936 100%);">
        <h3>Categories</h3>
        <div class="stat-value" id="categoriesCount">
         5
        </div>
        <div class="stat-label">
         Design types
        </div>
       </div>
       <div class="stat-card" style="background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);">
        <h3>Total Users</h3>
        <div class="stat-value" id="totalUsers">
         0
        </div>
        <div class="stat-label">
         Registered users
        </div>
       </div>
      </div>
      <div class="products-grid" id="adminProductsGrid"></div>
     </div>
    </main>
   </div>
  </div><!-- Upload Product Modal -->
  <div id="uploadModal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeUploadModal()">√ó</button>
    <h2 style="margin-bottom: 24px; color: #2d3748;">Upload New Design</h2>
    <div class="loading-spinner" id="uploadLoading">
     ‚è≥ Uploading...
    </div>
    <form id="uploadForm" onsubmit="handleUpload(event)">
     <div class="form-group"><label>Upload Image from Gallery</label>
      <div class="image-upload-area" id="uploadArea" onclick="document.getElementById('productImage').click()">
       <div class="upload-icon">
        üì∏
       </div>
       <p style="color: #718096; font-size: 15px; font-weight: 600;">Click to select image from your device</p>
       <p style="color: #a0aec0; font-size: 13px; margin-top: 8px;">Supports: JPG, PNG, GIF (Max 5MB)</p>
      </div><input type="file" id="productImage" accept="image/*" style="display: none;" onchange="previewImage(event)"> <img id="imagePreview" class="image-preview" alt="Preview">
     </div>
     <div class="form-group"><label for="productName">Design Name *</label> <input type="text" id="productName" required placeholder="e.g., Royal Mirror Work Pattern">
     </div>
     <div class="form-group"><label for="productCategory">Category *</label> <select id="productCategory" required> <option value="">Select Category</option> <option value="Mirror Work">Mirror Work</option> <option value="Hand Embroidery">Hand Embroidery</option> <option value="Zari Work">Zari Work</option> <option value="Thread Work">Thread Work</option> <option value="Sequin Work">Sequin Work</option> </select>
     </div>
     <div class="form-group"><label for="productTags">Search Tags (comma separated) *</label> <input type="text" id="productTags" required placeholder="e.g., mirror, bridal, traditional, golden">
      <p style="font-size: 12px; color: #718096; margin-top: 4px;">Add keywords to help users find this design (mirror design, hand design, zari work, etc.)</p>
     </div>
     <div class="form-group"><label for="productPrice">Price (‚Çπ) *</label> <input type="number" id="productPrice" required min="0" step="0.01" placeholder="e.g., 1299">
     </div>
     <div class="form-group"><label for="productDescription">Description</label> <textarea id="productDescription" placeholder="Describe the design, materials, and special features..."></textarea>
     </div>
     <div class="form-group"><label for="productRating">Rating (1-5)</label> <input type="number" id="productRating" min="1" max="5" step="0.1" value="4.5">
     </div>
     <div class="form-group"><label for="productReviews">Number of Reviews</label> <input type="number" id="productReviews" min="0" value="0">
     </div>
     <div class="form-group"><label style="display: flex; align-items: center; gap: 10px; cursor: pointer;"> <input type="checkbox" id="productInStock" checked style="width: 22px; height: 22px; accent-color: #667eea;"> <span>In Stock</span> </label>
     </div><button type="submit" class="btn btn-primary"> Upload Design </button>
    </form>
   </div>
  </div><!-- Drawing Modal -->
  <div id="drawingModal" class="modal">
   <div class="modal-content" style="max-width: 800px;"><button class="modal-close" onclick="closeDrawingModal()">√ó</button>
    <h2 style="margin-bottom: 24px; color: #2d3748;">‚úèÔ∏è Draw Your Design</h2>
    <p style="color: #718096; margin-bottom: 20px;">Sketch your design idea and we'll search for similar patterns</p>
    <div style="background: #f7fafc; border-radius: 12px; padding: 16px; margin-bottom: 20px;">
     <div style="display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap;"><button onclick="setDrawingColor('#000000')" class="btn btn-small" style="background: #000000; color: white;">‚ö´ Black</button> <button onclick="setDrawingColor('#667eea')" class="btn btn-small" style="background: #667eea; color: white;">üîµ Blue</button> <button onclick="setDrawingColor('#f56565')" class="btn btn-small" style="background: #f56565; color: white;">üî¥ Red</button> <button onclick="setDrawingColor('#48bb78')" class="btn btn-small" style="background: #48bb78; color: white;">üü¢ Green</button> <button onclick="setDrawingColor('#f6ad55')" class="btn btn-small" style="background: #f6ad55; color: white;">üü† Orange</button> <button onclick="clearCanvas()" class="btn btn-outline btn-small">üóëÔ∏è Clear</button>
     </div>
     <canvas id="drawingCanvas" width="700" height="500" style="background: white; border-radius: 8px; cursor: crosshair; display: block; width: 100%; max-width: 700px; height: auto; touch-action: none;"></canvas>
    </div><button onclick="searchByDrawing()" class="btn btn-primary" style="width: 100%;"> üîç Search Similar Designs </button>
   </div>
  </div><!-- Image Search Modal -->
  <div id="imageSearchModal" class="modal">
   <div class="modal-content"><button class="modal-close" onclick="closeImageSearchModal()">√ó</button>
    <h2 style="margin-bottom: 24px; color: #2d3748;">üì∑ Search by Image</h2>
    <p style="color: #718096; margin-bottom: 20px;">Upload an image to find similar embroidery designs</p>
    <div class="image-upload-area" id="searchImageArea" onclick="document.getElementById('searchImage').click()">
     <div class="upload-icon">
      üì∏
     </div>
     <p style="color: #718096; font-size: 15px; font-weight: 600;">Click to upload image</p>
     <p style="color: #a0aec0; font-size: 13px; margin-top: 8px;">JPG, PNG, GIF (Max 5MB)</p>
    </div><input type="file" id="searchImage" accept="image/*" style="display: none;" onchange="previewSearchImage(event)"> <img id="searchImagePreview" class="image-preview" alt="Search Preview"> <button onclick="searchByImage()" class="btn btn-primary" style="width: 100%; margin-top: 20px;"> üîç Find Similar Designs </button>
   </div>
  </div><!-- Voice Search Indicator -->
  <div id="voiceIndicator" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 48px; border-radius: 24px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); z-index: 2000; text-align: center;">
   <div style="font-size: 72px; margin-bottom: 20px; animation: pulse 1.5s infinite;">
    üé§
   </div>
   <h3 style="color: #2d3748; margin-bottom: 12px; font-size: 24px;">Listening...</h3>
   <p style="color: #718096; font-size: 16px; margin-bottom: 24px;">Say something like "kurti design" or "mirror work"</p><button onclick="stopVoiceSearch()" class="btn btn-danger">Stop</button>
  </div>
  <div id="notification" class="notification"></div>
  <script>
    // Configuration
    const defaultConfig = {
      store_name: "EmbroiTech",
      store_tagline: "Premium Embroidery Designs",
      welcome_message: "Discover Beautiful Embroidery Designs",
      contact_email: "contact@embroitech.com",
      contact_phone: "+91 98765 43210"
    };

    // State
    let allRecords = [];
    let currentUser = null;
    let cartItems = [];
    let wishlistItems = [];
    let currentView = 'browse';
    let viewMode = 'grid';
    let searchTimeout = null;
    let recognition = null;
    let drawingCanvas = null;
    let drawingContext = null;
    let isDrawing = false;
    let currentColor = '#000000';

    // Data SDK Handler
    const dataHandler = {
      onDataChanged(data) {
        allRecords = data;
        updateUI();
      }
    };

    // Initialize
    async function init() {
      showLoading();
      
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        console.error("Failed to initialize Data SDK");
      }

      if (window.elementSdk) {
        await window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            document.getElementById('storeName').textContent = config.store_name || defaultConfig.store_name;
            document.getElementById('authStoreName').textContent = config.store_name || defaultConfig.store_name;
            document.getElementById('storeTagline').textContent = config.store_tagline || defaultConfig.store_tagline;
            document.getElementById('authWelcomeMessage').textContent = config.welcome_message || defaultConfig.welcome_message;
            document.getElementById('contactEmail').textContent = config.contact_email || defaultConfig.contact_email;
            document.getElementById('contactPhone').textContent = config.contact_phone || defaultConfig.contact_phone;
          },
          mapToCapabilities: (config) => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (config) => new Map([
            ["store_name", config.store_name || defaultConfig.store_name],
            ["store_tagline", config.store_tagline || defaultConfig.store_tagline],
            ["welcome_message", config.welcome_message || defaultConfig.welcome_message],
            ["contact_email", config.contact_email || defaultConfig.contact_email],
            ["contact_phone", config.contact_phone || defaultConfig.contact_phone]
          ])
        });
      }

      hideLoading();
      checkAuth();
    }

    // Authentication
    function checkAuth() {
      const savedUser = localStorage.getItem('embroitech_user');
      if (savedUser) {
        currentUser = JSON.parse(savedUser);
        showMainApp();
      } else {
        showAuthScreen();
      }
    }

    function showAuthScreen() {
      document.getElementById('authScreen').style.display = 'flex';
      document.getElementById('mainApp').style.display = 'none';
    }

    function showMainApp() {
      document.getElementById('authScreen').style.display = 'none';
      document.getElementById('mainApp').style.display = 'block';
      
      const initials = currentUser.fullName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
      document.getElementById('userAvatar').textContent = initials;
      document.getElementById('userDisplayName').textContent = currentUser.fullName;
      document.getElementById('userDisplayEmail').textContent = currentUser.email;
      
      if (currentUser.isAdmin) {
        document.getElementById('adminMenuItem').style.display = 'flex';
      }
      
      loadUserProfile();
      updateUI();
    }

    function showLogin() {
      document.getElementById('loginForm').style.display = 'block';
      document.getElementById('signupForm').style.display = 'none';
    }

    function showSignup() {
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('signupForm').style.display = 'block';
    }

    async function handleLogin(event) {
      event.preventDefault();
      
      const email = document.getElementById('loginEmail').value.trim().toLowerCase();
      const password = document.getElementById('loginPassword').value;
      
      const loginBtn = document.getElementById('loginBtn');
      loginBtn.disabled = true;
      loginBtn.textContent = 'üîÑ Signing in...';
      
      const users = allRecords.filter(r => r.type === 'user');
      const user = users.find(u => u.email === email && u.password === password);
      
      if (user) {
        currentUser = user;
        localStorage.setItem('embroitech_user', JSON.stringify(user));
        showNotification('‚úÖ Welcome back, ' + user.fullName + '!');
        showMainApp();
      } else {
        showNotification('‚ùå Invalid email or password', 'error');
        loginBtn.disabled = false;
        loginBtn.textContent = 'üîê Sign In';
      }
    }

    async function handleSignup(event) {
      event.preventDefault();
      
      if (allRecords.filter(r => r.type === 'user').length >= 999) {
        showNotification('‚ùå Maximum user limit reached', 'error');
        return;
      }
      
      const fullName = document.getElementById('signupFullName').value.trim();
      const email = document.getElementById('signupEmail').value.trim().toLowerCase();
      const phone = document.getElementById('signupPhone').value.trim();
      const password = document.getElementById('signupPassword').value;
      const address = document.getElementById('signupAddress').value.trim();
      
      const users = allRecords.filter(r => r.type === 'user');
      if (users.find(u => u.email === email)) {
        showNotification('‚ùå Email already registered', 'error');
        return;
      }
      
      const signupBtn = document.getElementById('signupBtn');
      signupBtn.disabled = true;
      signupBtn.textContent = 'üîÑ Creating account...';
      
      const isFirstUser = users.length === 0;
      
      const newUser = {
        id: Date.now().toString(),
        type: 'user',
        username: email.split('@')[0],
        email: email,
        password: password,
        fullName: fullName,
        phone: phone,
        address: address,
        isAdmin: isFirstUser,
        createdAt: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(newUser);
      
      if (result.isOk) {
        showNotification('‚úÖ Account created successfully! ' + (isFirstUser ? 'You are the admin!' : ''));
        showLogin();
        document.getElementById('loginEmail').value = email;
      } else {
        showNotification('‚ùå Failed to create account', 'error');
        signupBtn.disabled = false;
        signupBtn.textContent = '‚ú® Create Account';
      }
    }

    function handleLogout() {
      localStorage.removeItem('embroitech_user');
      currentUser = null;
      cartItems = [];
      wishlistItems = [];
      showNotification('üëã Logged out successfully');
      showAuthScreen();
      showLogin();
    }

    function checkPasswordStrength() {
      const password = document.getElementById('signupPassword').value;
      const bar = document.getElementById('passwordStrengthBar');
      
      let strength = 0;
      if (password.length >= 8) strength++;
      if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
      if (/\d/.test(password)) strength++;
      if (/[^a-zA-Z\d]/.test(password)) strength++;
      
      bar.className = 'password-strength-bar';
      if (strength <= 1) bar.classList.add('weak');
      else if (strength <= 2) bar.classList.add('medium');
      else bar.classList.add('strong');
    }

    // UI Updates
    function updateUI() {
      updateStats();
      updateCategoryCounts();
      renderProducts();
      renderCategories();
      renderTrending();
      renderNewArrivals();
      renderWishlist();
      renderCart();
      renderAdminProducts();
    }

    function updateStats() {
      const products = allRecords.filter(r => r.type === 'product');
      const users = allRecords.filter(r => r.type === 'user');
      
      document.getElementById('totalDesigns').textContent = products.length;
      document.getElementById('inStockCount').textContent = products.filter(p => p.inStock).length;
      document.getElementById('totalUsers').textContent = users.length;
    }

    function updateCategoryCounts() {
      const products = allRecords.filter(r => r.type === 'product');
      const categories = ['Mirror Work', 'Hand Embroidery', 'Zari Work', 'Thread Work', 'Sequin Work'];
      
      categories.forEach(cat => {
        const count = products.filter(p => p.category === cat).length;
        const id = 'count' + cat.replace(/\s+/g, '');
        const el = document.getElementById(id);
        if (el) el.textContent = count;
      });
    }

    // Search
    function handleSearch() {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        applyFilters();
      }, 300);
    }

    function showSearchSuggestions() {
      const searchTerm = document.getElementById('mainSearch').value.toLowerCase().trim();
      const suggestions = document.getElementById('searchSuggestions');
      
      if (!searchTerm) {
        const popularSearches = [
          { icon: 'ü™û', text: 'Mirror Design', desc: 'Traditional mirror work' },
          { icon: '‚úã', text: 'Hand Design', desc: 'Hand embroidery patterns' },
          { icon: '‚ú®', text: 'Zari Work', desc: 'Golden zari embroidery' },
          { icon: 'üßµ', text: 'Thread Work', desc: 'Colorful thread designs' },
          { icon: 'üíé', text: 'Sequin Work', desc: 'Sparkling sequin patterns' },
          { icon: 'üëó', text: 'Kurti Design', desc: 'Beautiful kurti patterns' },
          { icon: 'üëò', text: 'Choli Design', desc: 'Elegant choli embroidery' },
          { icon: 'üíÉ', text: 'Ghagra Design', desc: 'Traditional ghagra work' }
        ];
        
        suggestions.innerHTML = popularSearches.map(s => `
          <div class="search-suggestion-item" onmousedown="searchFor('${s.text}')">
            <span class="suggestion-icon">${s.icon}</span>
            <div class="suggestion-text">
              <strong>${s.text}</strong>
              <span>${s.desc}</span>
            </div>
          </div>
        `).join('');
        suggestions.classList.add('active');
        return;
      }
      
      const products = allRecords.filter(r => r.type === 'product');
      const matches = products.filter(p => 
        p.productName.toLowerCase().includes(searchTerm) ||
        p.category.toLowerCase().includes(searchTerm) ||
        (p.tags && p.tags.toLowerCase().includes(searchTerm)) ||
        (p.description && p.description.toLowerCase().includes(searchTerm))
      ).slice(0, 5);
      
      if (matches.length > 0) {
        suggestions.innerHTML = matches.map(p => `
          <div class="search-suggestion-item" onmousedown="viewProduct('${p.__backendId}')">
            <span class="suggestion-icon">${getEmojiForCategory(p.category)}</span>
            <div class="suggestion-text">
              <strong>${p.productName}</strong>
              <span>${p.category} ‚Ä¢ ‚Çπ${p.price}</span>
            </div>
          </div>
        `).join('');
        suggestions.classList.add('active');
      } else {
        suggestions.classList.remove('active');
      }
    }

    function hideSearchSuggestions() {
      setTimeout(() => {
        document.getElementById('searchSuggestions').classList.remove('active');
      }, 200);
    }

    function searchFor(term) {
      document.getElementById('mainSearch').value = term;
      applyFilters();
      showView('browse');
    }

    function viewProduct(backendId) {
      showView('browse');
      const element = document.querySelector(`[data-product-id="${backendId}"]`);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        element.style.animation = 'pulse 1s';
      }
    }

    // Filters
    function getFilteredProducts() {
      let products = allRecords.filter(r => r.type === 'product');
      
      const searchTerm = document.getElementById('mainSearch').value.toLowerCase().trim();
      if (searchTerm) {
        products = products.filter(p => 
          p.productName.toLowerCase().includes(searchTerm) ||
          p.category.toLowerCase().includes(searchTerm) ||
          (p.tags && p.tags.toLowerCase().includes(searchTerm)) ||
          (p.description && p.description.toLowerCase().includes(searchTerm))
        );
      }
      
      const categoryFilters = [];
      if (document.getElementById('filterMirror').checked) categoryFilters.push('Mirror Work');
      if (document.getElementById('filterHand').checked) categoryFilters.push('Hand Embroidery');
      if (document.getElementById('filterZari').checked) categoryFilters.push('Zari Work');
      if (document.getElementById('filterThread').checked) categoryFilters.push('Thread Work');
      if (document.getElementById('filterSequin').checked) categoryFilters.push('Sequin Work');
      
      if (categoryFilters.length > 0) {
        products = products.filter(p => categoryFilters.includes(p.category));
      }
      
      const minPrice = parseFloat(document.getElementById('minPrice').value) || 0;
      const maxPrice = parseFloat(document.getElementById('maxPrice').value) || Infinity;
      products = products.filter(p => p.price >= minPrice && p.price <= maxPrice);
      
      if (document.getElementById('rating5').checked) {
        products = products.filter(p => p.rating >= 5);
      } else if (document.getElementById('rating4').checked) {
        products = products.filter(p => p.rating >= 4);
      } else if (document.getElementById('rating3').checked) {
        products = products.filter(p => p.rating >= 3);
      }
      
      if (document.getElementById('inStockOnly').checked) {
        products = products.filter(p => p.inStock);
      }
      
      const sortBy = document.getElementById('sortSelect').value;
      if (sortBy === 'price-low') {
        products.sort((a, b) => a.price - b.price);
      } else if (sortBy === 'price-high') {
        products.sort((a, b) => b.price - a.price);
      } else if (sortBy === 'rating') {
        products.sort((a, b) => b.rating - a.rating);
      } else if (sortBy === 'popular') {
        products.sort((a, b) => b.reviews - a.reviews);
      } else {
        products.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
      }
      
      return products;
    }

    function applyFilters() {
      renderProducts();
    }

    function clearFilters() {
      document.getElementById('mainSearch').value = '';
      document.getElementById('filterMirror').checked = false;
      document.getElementById('filterHand').checked = false;
      document.getElementById('filterZari').checked = false;
      document.getElementById('filterThread').checked = false;
      document.getElementById('filterSequin').checked = false;
      document.getElementById('minPrice').value = '';
      document.getElementById('maxPrice').value = '';
      document.getElementById('rating5').checked = false;
      document.getElementById('rating4').checked = false;
      document.getElementById('rating3').checked = false;
      document.getElementById('inStockOnly').checked = false;
      document.getElementById('sortSelect').value = 'newest';
      applyFilters();
    }

    // Rendering
    function renderProducts() {
      const grid = document.getElementById('productsGrid');
      const products = getFilteredProducts();
      
      document.getElementById('resultsCount').textContent = `(${products.length} items)`;
      
      if (products.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üîç</div>
            <h3>No designs found</h3>
            <p>Try adjusting your filters or search terms</p>
            <button class="btn btn-primary" onclick="clearFilters()" style="margin-top: 20px;">Clear Filters</button>
          </div>
        `;
        return;
      }
      
      grid.className = viewMode === 'grid' ? 'products-grid' : 'products-list';
      
      grid.innerHTML = products.map(p => renderProductCard(p, viewMode === 'list')).join('');
    }

    function renderProductCard(product, isList = false) {
      const isNew = (Date.now() - new Date(product.createdAt).getTime()) < 7 * 24 * 60 * 60 * 1000;
      const tags = product.tags ? product.tags.split(',').map(t => t.trim()).slice(0, 3) : [];
      
      const cardClass = isList ? 'product-card-list' : 'product-card';
      
      return `
        <div class="${cardClass}" data-product-id="${product.__backendId}">
          ${product.inStock ? 
            (isNew ? '<div class="product-badge new">New</div>' : '<div class="product-badge">In Stock</div>') : 
            '<div class="product-badge out-of-stock">Out of Stock</div>'}
          <button class="wishlist-btn ${isInWishlist(product.__backendId) ? 'active' : ''}" onclick="toggleWishlist('${product.__backendId}')">
            ${isInWishlist(product.__backendId) ? '‚ù§Ô∏è' : 'ü§ç'}
          </button>
          <div class="product-image">
            ${product.imageData ? `<img src="${product.imageData}" alt="${product.productName}">` : getEmojiForCategory(product.category)}
          </div>
          <div class="product-info">
            <span class="product-category">${product.category}</span>
            ${tags.length > 0 ? `
              <div class="product-tags">
                ${tags.map(tag => `<span class="product-tag">#${tag}</span>`).join('')}
              </div>
            ` : ''}
            <div class="product-name">${product.productName}</div>
            <div class="product-rating">
              <span class="stars">${'‚≠ê'.repeat(Math.floor(product.rating))}</span>
              <span class="rating-value">${product.rating}</span>
              <span class="review-count">(${product.reviews} reviews)</span>
            </div>
            <div class="product-price">‚Çπ${product.price.toFixed(2)}</div>
            ${product.description ? `<p style="font-size: 13px; color: #718096; margin-bottom: 12px; line-height: 1.5;">${product.description.substring(0, 100)}${product.description.length > 100 ? '...' : ''}</p>` : ''}
            <div class="product-actions">
              <button class="btn btn-primary btn-small" onclick="addToCart('${product.__backendId}')" ${!product.inStock ? 'disabled' : ''}>
                ${product.inStock ? 'üõí Add to Cart' : 'Out of Stock'}
              </button>
              ${currentUser && currentUser.isAdmin ? `
                <button class="btn btn-danger btn-small" onclick="deleteProduct('${product.__backendId}')">
                  üóëÔ∏è
                </button>
              ` : ''}
            </div>
          </div>
        </div>
      `;
    }

    function renderCategories() {
      const grid = document.getElementById('categoriesGrid');
      const categories = [
        { name: 'Mirror Work', emoji: 'ü™û', desc: 'Traditional mirror embroidery' },
        { name: 'Hand Embroidery', emoji: '‚úã', desc: 'Handcrafted designs' },
        { name: 'Zari Work', emoji: '‚ú®', desc: 'Golden zari patterns' },
        { name: 'Thread Work', emoji: 'üßµ', desc: 'Colorful thread art' },
        { name: 'Sequin Work', emoji: 'üíé', desc: 'Sparkling sequin designs' }
      ];
      
      grid.innerHTML = categories.map(cat => {
        const count = allRecords.filter(r => r.type === 'product' && r.category === cat.name).length;
        return `
          <div class="product-card" onclick="filterByCategory('${cat.name}')">
            <div class="product-image" style="font-size: 96px;">${cat.emoji}</div>
            <div class="product-info">
              <div class="product-name">${cat.name}</div>
              <p style="color: #718096; font-size: 14px; margin-bottom: 8px;">${cat.desc}</p>
              <p style="color: #667eea; font-weight: 600;">${count} designs available</p>
            </div>
          </div>
        `;
      }).join('');
    }

    function renderTrending() {
      const grid = document.getElementById('trendingGrid');
      const products = allRecords
        .filter(r => r.type === 'product')
        .sort((a, b) => b.reviews - a.reviews)
        .slice(0, 12);
      
      if (products.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üî•</div>
            <h3>No trending designs yet</h3>
            <p>Check back soon for popular items</p>
          </div>
        `;
        return;
      }
      
      grid.innerHTML = products.map(p => renderProductCard(p)).join('');
    }

    function renderNewArrivals() {
      const grid = document.getElementById('newGrid');
      const products = allRecords
        .filter(r => r.type === 'product')
        .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
        .slice(0, 12);
      
      if (products.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚ú®</div>
            <h3>No new arrivals yet</h3>
            <p>Be the first to upload designs</p>
          </div>
        `;
        return;
      }
      
      grid.innerHTML = products.map(p => renderProductCard(p)).join('');
    }

    function renderWishlist() {
      const grid = document.getElementById('wishlistGrid');
      const products = allRecords.filter(r => r.type === 'product' && isInWishlist(r.__backendId));
      
      if (products.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚ù§Ô∏è</div>
            <h3>Your wishlist is empty</h3>
            <p>Add designs you love to your wishlist</p>
            <button class="btn btn-primary" onclick="showView('browse')" style="margin-top: 20px;">Browse Designs</button>
          </div>
        `;
        return;
      }
      
      grid.innerHTML = products.map(p => renderProductCard(p)).join('');
    }

    function renderCart() {
      const container = document.getElementById('cartContent');
      
      if (cartItems.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üõí</div>
            <h3>Your cart is empty</h3>
            <p>Add some beautiful designs to get started</p>
            <button class="btn btn-primary" onclick="showView('browse')" style="margin-top: 20px;">Start Shopping</button>
          </div>
        `;
        return;
      }
      
      const subtotal = cartItems.reduce((sum, item) => sum + item.price, 0);
      const shipping = subtotal > 2000 ? 0 : 50;
      const total = subtotal + shipping;
      
      container.innerHTML = `
        <div style="display: flex; flex-direction: column; gap: 20px;">
          ${cartItems.map(item => `
            <div style="display: flex; gap: 20px; padding: 20px; border: 2px solid #e2e8f0; border-radius: 16px; align-items: center;">
              <div style="width: 120px; height: 120px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 48px; flex-shrink: 0; overflow: hidden;">
                ${item.imageData ? `<img src="${item.imageData}" alt="${item.productName}" style="width: 100%; height: 100%; object-fit: cover;">` : getEmojiForCategory(item.category)}
              </div>
              <div style="flex: 1;">
                <div style="font-weight: 700; font-size: 18px; margin-bottom: 4px;">${item.productName}</div>
                <div style="font-size: 13px; color: #718096; margin-bottom: 8px;">${item.category}</div>
                <div style="color: #48bb78; font-weight: 700; font-size: 20px;">‚Çπ${item.price.toFixed(2)}</div>
              </div>
              <button class="btn btn-danger btn-small" onclick="removeFromCart('${item.__backendId}')">
                Remove
              </button>
            </div>
          `).join('')}
          
          <div style="background: #f7fafc; padding: 28px; border-radius: 16px; margin-top: 20px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 16px; font-size: 16px;">
              <span>Subtotal:</span>
              <span style="font-weight: 600;">‚Çπ${subtotal.toFixed(2)}</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 16px; font-size: 16px;">
              <span>Shipping:</span>
              <span style="font-weight: 600;">${shipping === 0 ? 'FREE' : '‚Çπ' + shipping.toFixed(2)}</span>
            </div>
            ${shipping === 0 ? '<p style="font-size: 13px; color: #48bb78; margin-bottom: 16px;">üéâ You got free shipping!</p>' : '<p style="font-size: 13px; color: #718096; margin-bottom: 16px;">Free shipping on orders above ‚Çπ2000</p>'}
            <div style="display: flex; justify-content: space-between; font-size: 24px; font-weight: 700; color: #2d3748; padding-top: 20px; border-top: 2px solid #e2e8f0; margin-top: 12px;">
              <span>Total:</span>
              <span style="color: #48bb78;">‚Çπ${total.toFixed(2)}</span>
            </div>
          </div>
          
          <button class="btn btn-primary" onclick="proceedToCheckout()" style="width: 100%; font-size: 18px; padding: 18px;">
            üí≥ Proceed to Checkout
          </button>
          
          <div style="background: #fff5f5; border-left: 4px solid #f56565; padding: 16px; border-radius: 8px;">
            <p style="color: #c53030; font-weight: 600; margin-bottom: 4px;">‚ö†Ô∏è Demo Mode</p>
            <p style="color: #742a2a; font-size: 13px;">This is a prototype. Real payment processing requires Razorpay/Stripe integration.</p>
          </div>
        </div>
      `;
    }

    function renderAdminProducts() {
      const grid = document.getElementById('adminProductsGrid');
      const products = allRecords.filter(r => r.type === 'product');
      
      if (products.length === 0) {
        grid.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üì¶</div>
            <h3>No designs uploaded yet</h3>
            <p>Click "Upload Design" to add your first design</p>
          </div>
        `;
        return;
      }
      
      grid.innerHTML = products.map(p => renderProductCard(p)).join('');
    }

    // View Management
    function showView(view) {
      currentView = view;
      document.querySelectorAll('.view-content').forEach(v => v.style.display = 'none');
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      
      const viewMap = {
        'browse': 'browseView',
        'categories': 'categoriesView',
        'trending': 'trendingView',
        'new': 'newView',
        'wishlist': 'wishlistView',
        'cart': 'cartView',
        'profile': 'profileView',
        'orders': 'ordersView',
        'about': 'aboutView',
        'admin': 'adminView'
      };
      
      const viewId = viewMap[view];
      if (viewId) {
        document.getElementById(viewId).style.display = 'block';
      }
      
      closeUserMenu();
    }

    function setViewMode(mode) {
      viewMode = mode;
      document.getElementById('gridViewBtn').classList.toggle('active', mode === 'grid');
      document.getElementById('listViewBtn').classList.toggle('active', mode === 'list');
      renderProducts();
    }

    function filterByCategory(category) {
      clearFilters();
      const checkboxId = 'filter' + category.replace(/\s+/g, '');
      const checkbox = document.getElementById(checkboxId);
      if (checkbox) checkbox.checked = true;
      showView('browse');
      applyFilters();
    }

    // Cart & Wishlist
    function addToCart(backendId) {
      const product = allRecords.find(r => r.__backendId === backendId);
      if (!product || !product.inStock) return;
      
      if (cartItems.find(item => item.__backendId === backendId)) {
        showNotification('‚ÑπÔ∏è Item already in cart!', 'info');
        return;
      }
      
      cartItems.push(product);
      updateCartCount();
      showNotification('‚úÖ Added to cart!');
    }

    function removeFromCart(backendId) {
      cartItems = cartItems.filter(item => item.__backendId !== backendId);
      updateCartCount();
      renderCart();
      showNotification('üóëÔ∏è Removed from cart');
    }

    function updateCartCount() {
      document.getElementById('cartCount').textContent = cartItems.length;
    }

    function toggleWishlist(backendId) {
      const index = wishlistItems.indexOf(backendId);
      if (index > -1) {
        wishlistItems.splice(index, 1);
        showNotification('üíî Removed from wishlist');
      } else {
        wishlistItems.push(backendId);
        showNotification('‚ù§Ô∏è Added to wishlist');
      }
      updateWishlistCount();
      renderProducts();
      renderWishlist();
    }

    function isInWishlist(backendId) {
      return wishlistItems.includes(backendId);
    }

    function updateWishlistCount() {
      document.getElementById('wishlistCount').textContent = wishlistItems.length;
    }

    function proceedToCheckout() {
      showNotification('‚úÖ Demo checkout complete! In production, integrate Razorpay/Stripe for real payments.');
      cartItems = [];
      updateCartCount();
      showView('orders');
    }

    // User Menu
    function toggleUserMenu() {
      document.getElementById('userDropdown').classList.toggle('active');
    }

    function closeUserMenu() {
      document.getElementById('userDropdown').classList.remove('active');
    }

    // Profile
    function loadUserProfile() {
      if (!currentUser) return;
      
      document.getElementById('profileName').value = currentUser.fullName || '';
      document.getElementById('profileEmail').value = currentUser.email || '';
      document.getElementById('profilePhone').value = currentUser.phone || '';
      document.getElementById('profileAddress').value = currentUser.address || '';
    }

    async function updateProfile(event) {
      event.preventDefault();
      
      const updatedUser = {
        ...currentUser,
        fullName: document.getElementById('profileName').value,
        phone: document.getElementById('profilePhone').value,
        address: document.getElementById('profileAddress').value
      };
      
      const result = await window.dataSdk.update(updatedUser);
      
      if (result.isOk) {
        currentUser = updatedUser;
        localStorage.setItem('embroitech_user', JSON.stringify(updatedUser));
        document.getElementById('userDisplayName').textContent = updatedUser.fullName;
        showNotification('‚úÖ Profile updated successfully!');
      } else {
        showNotification('‚ùå Failed to update profile', 'error');
      }
    }

    // Admin Functions
    function openUploadModal() {
      document.getElementById('uploadModal').classList.add('active');
      document.getElementById('uploadForm').reset();
      document.getElementById('imagePreview').classList.remove('active');
      document.getElementById('uploadArea').classList.remove('has-image');
    }

    function closeUploadModal() {
      document.getElementById('uploadModal').classList.remove('active');
    }

    function previewImage(event) {
      const file = event.target.files[0];
      if (file) {
        if (file.size > 5 * 1024 * 1024) {
          showNotification('‚ùå Image size must be less than 5MB', 'error');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
          const preview = document.getElementById('imagePreview');
          preview.src = e.target.result;
          preview.classList.add('active');
          document.getElementById('uploadArea').classList.add('has-image');
        };
        reader.readAsDataURL(file);
      }
    }

    async function handleUpload(event) {
      event.preventDefault();
      
      if (allRecords.filter(r => r.type === 'product').length >= 999) {
        showNotification('‚ùå Maximum limit of 999 designs reached. Please delete some first.', 'error');
        return;
      }
      
      const loading = document.getElementById('uploadLoading');
      loading.classList.add('active');
      
      const imagePreview = document.getElementById('imagePreview');
      const imageData = imagePreview.classList.contains('active') ? imagePreview.src : '';
      
      const product = {
        id: Date.now().toString(),
        type: 'product',
        productName: document.getElementById('productName').value,
        category: document.getElementById('productCategory').value,
        tags: document.getElementById('productTags').value,
        price: parseFloat(document.getElementById('productPrice').value),
        description: document.getElementById('productDescription').value,
        imageData: imageData,
        rating: parseFloat(document.getElementById('productRating').value),
        reviews: parseInt(document.getElementById('productReviews').value),
        inStock: document.getElementById('productInStock').checked,
        uploadedBy: currentUser.email,
        createdAt: new Date().toISOString()
      };
      
      const result = await window.dataSdk.create(product);
      
      loading.classList.remove('active');
      
      if (result.isOk) {
        showNotification('‚úÖ Design uploaded successfully!');
        closeUploadModal();
      } else {
        showNotification('‚ùå Failed to upload design. Please try again.', 'error');
      }
    }

    async function deleteProduct(backendId) {
      const product = allRecords.find(r => r.__backendId === backendId);
      if (!product) return;
      
      const result = await window.dataSdk.delete(product);
      
      if (result.isOk) {
        showNotification('‚úÖ Design deleted successfully!');
      } else {
        showNotification('‚ùå Failed to delete design.', 'error');
      }
    }

    // Utility Functions
    function getEmojiForCategory(category) {
      const emojis = {
        'Mirror Work': 'ü™û',
        'Hand Embroidery': '‚úã',
        'Zari Work': '‚ú®',
        'Thread Work': 'üßµ',
        'Sequin Work': 'üíé'
      };
      return emojis[category] || 'üé®';
    }

    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = 'notification active';
      if (type === 'error') {
        notification.classList.add('error');
      } else if (type === 'info') {
        notification.classList.add('info');
      }
      
      setTimeout(() => {
        notification.classList.remove('active');
      }, 4000);
    }

    function showLoading() {
      document.getElementById('loadingOverlay').classList.add('active');
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('active');
    }

    // Voice Search
    function startVoiceSearch() {
      if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
        showNotification('‚ùå Voice search not supported in this browser. Try Chrome or Edge.', 'error');
        return;
      }
      
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.lang = 'en-IN';
      recognition.continuous = false;
      recognition.interimResults = false;
      
      document.getElementById('voiceIndicator').style.display = 'block';
      
      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript.toLowerCase();
        document.getElementById('mainSearch').value = transcript;
        showNotification('üé§ Heard: "' + transcript + '"');
        stopVoiceSearch();
        applyFilters();
        showView('browse');
      };
      
      recognition.onerror = function(event) {
        showNotification('‚ùå Voice search error. Please try again.', 'error');
        stopVoiceSearch();
      };
      
      recognition.onend = function() {
        stopVoiceSearch();
      };
      
      recognition.start();
    }
    
    function stopVoiceSearch() {
      if (recognition) {
        recognition.stop();
        recognition = null;
      }
      document.getElementById('voiceIndicator').style.display = 'none';
    }

    // Drawing Canvas
    function openDrawingModal() {
      document.getElementById('drawingModal').classList.add('active');
      
      if (!drawingCanvas) {
        drawingCanvas = document.getElementById('drawingCanvas');
        drawingContext = drawingCanvas.getContext('2d');
        drawingContext.lineWidth = 3;
        drawingContext.lineCap = 'round';
        drawingContext.strokeStyle = currentColor;
        
        // Mouse events
        drawingCanvas.addEventListener('mousedown', startDrawing);
        drawingCanvas.addEventListener('mousemove', draw);
        drawingCanvas.addEventListener('mouseup', stopDrawing);
        drawingCanvas.addEventListener('mouseout', stopDrawing);
        
        // Touch events
        drawingCanvas.addEventListener('touchstart', handleTouchStart);
        drawingCanvas.addEventListener('touchmove', handleTouchMove);
        drawingCanvas.addEventListener('touchend', stopDrawing);
      }
    }
    
    function closeDrawingModal() {
      document.getElementById('drawingModal').classList.remove('active');
    }
    
    function startDrawing(e) {
      isDrawing = true;
      const rect = drawingCanvas.getBoundingClientRect();
      const scaleX = drawingCanvas.width / rect.width;
      const scaleY = drawingCanvas.height / rect.height;
      drawingContext.beginPath();
      drawingContext.moveTo((e.clientX - rect.left) * scaleX, (e.clientY - rect.top) * scaleY);
    }
    
    function draw(e) {
      if (!isDrawing) return;
      const rect = drawingCanvas.getBoundingClientRect();
      const scaleX = drawingCanvas.width / rect.width;
      const scaleY = drawingCanvas.height / rect.height;
      drawingContext.lineTo((e.clientX - rect.left) * scaleX, (e.clientY - rect.top) * scaleY);
      drawingContext.stroke();
    }
    
    function stopDrawing() {
      isDrawing = false;
    }
    
    function handleTouchStart(e) {
      e.preventDefault();
      const touch = e.touches[0];
      const rect = drawingCanvas.getBoundingClientRect();
      const scaleX = drawingCanvas.width / rect.width;
      const scaleY = drawingCanvas.height / rect.height;
      isDrawing = true;
      drawingContext.beginPath();
      drawingContext.moveTo((touch.clientX - rect.left) * scaleX, (touch.clientY - rect.top) * scaleY);
    }
    
    function handleTouchMove(e) {
      e.preventDefault();
      if (!isDrawing) return;
      const touch = e.touches[0];
      const rect = drawingCanvas.getBoundingClientRect();
      const scaleX = drawingCanvas.width / rect.width;
      const scaleY = drawingCanvas.height / rect.height;
      drawingContext.lineTo((touch.clientX - rect.left) * scaleX, (touch.clientY - rect.top) * scaleY);
      drawingContext.stroke();
    }
    
    function setDrawingColor(color) {
      currentColor = color;
      drawingContext.strokeStyle = color;
    }
    
    function clearCanvas() {
      drawingContext.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
    }
    
    function searchByDrawing() {
      const imageData = drawingCanvas.toDataURL();
      
      if (drawingContext.getImageData(0, 0, drawingCanvas.width, drawingCanvas.height).data.some(channel => channel !== 0)) {
        showNotification('üé® Analyzing your drawing... Searching for similar designs!');
        closeDrawingModal();
        
        // Simulate AI search - in production, send to AI vision API
        setTimeout(() => {
          const searchTerms = ['embroidery', 'pattern', 'design', 'traditional'];
          const randomTerm = searchTerms[Math.floor(Math.random() * searchTerms.length)];
          document.getElementById('mainSearch').value = randomTerm;
          applyFilters();
          showView('browse');
          showNotification('‚ú® Found designs matching your sketch!');
        }, 1500);
      } else {
        showNotification('‚ö†Ô∏è Please draw something first!', 'info');
      }
    }

    // Image Search
    function openImageSearchModal() {
      document.getElementById('imageSearchModal').classList.add('active');
      document.getElementById('searchImagePreview').classList.remove('active');
      document.getElementById('searchImageArea').classList.remove('has-image');
    }
    
    function closeImageSearchModal() {
      document.getElementById('imageSearchModal').classList.remove('active');
    }
    
    function previewSearchImage(event) {
      const file = event.target.files[0];
      if (file) {
        if (file.size > 5 * 1024 * 1024) {
          showNotification('‚ùå Image size must be less than 5MB', 'error');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
          const preview = document.getElementById('searchImagePreview');
          preview.src = e.target.result;
          preview.classList.add('active');
          document.getElementById('searchImageArea').classList.add('has-image');
        };
        reader.readAsDataURL(file);
      }
    }
    
    function searchByImage() {
      const preview = document.getElementById('searchImagePreview');
      
      if (preview.classList.contains('active')) {
        showNotification('üì∏ Analyzing image... Searching for similar designs!');
        closeImageSearchModal();
        
        // Simulate AI image recognition - in production, use Google Vision API or similar
        setTimeout(() => {
          const detectedPatterns = ['mirror work', 'zari', 'embroidery', 'kurti', 'choli', 'ghagra'];
          const randomPattern = detectedPatterns[Math.floor(Math.random() * detectedPatterns.length)];
          document.getElementById('mainSearch').value = randomPattern;
          applyFilters();
          showView('browse');
          showNotification('‚ú® Found designs similar to your image!');
        }, 1500);
      } else {
        showNotification('‚ö†Ô∏è Please upload an image first!', 'info');
      }
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', function(event) {
      if (!event.target.closest('.user-menu')) {
        closeUserMenu();
      }
    });

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99b7f95233128b0b',t:'MTc2MjYzNTM1NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
